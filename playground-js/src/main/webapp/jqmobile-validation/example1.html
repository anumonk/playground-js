<!DOCTYPE html> 
<html> 
<head> 
  <title>Form Validation Example</title> 
	
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0-rc.2/jquery.mobile-1.1.0-rc.2.css" />
  <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.js"></script>
  <script src="http://code.jquery.com/mobile/1.1.0-rc.2/jquery.mobile-1.1.0-rc.2.min.js"></script>
  <script type="text/javascript">

	  $( document ).on( 'pageinit', '#add-item', function( event ) {

      var form = $( event.target ).find( 'form' );
      var validationModel = {
        rules : {
          age : "required",
          snack : "required",
          feedback: "required"
        },

        onchange : function(element){
          this.element(element);
        },

        errorPlacement : function( error, element ) {
            var container;
            if(element.is(":radio")) {
              container = findContainer(element);
              error.appendTo(container);
            }
            else{
              error.insertAfter(element);
            }

            function findContainer(e){
              if(e.data('role')==="fieldcontain"){
                return e;
              }
              else{
                return findContainer(e.parent());
              }
            }
          }
      };
          
      var validator = form.validate( validationModel );

      form.validateDelegate("[type='radio'], [type='checkbox'], select, option", "change", function(event){
        var eventType = "on" + event.type.replace(/^validate/, "");
        validator.settings[eventType] && validator.settings[eventType].call(validator, this[0], event);
      });

		});

	</script>

  <style>
    label.error { display: block; color: #fe7c6d; margin-top: 0.4em; }
    @media all and (min-width: 450px) {
      label.error { margin-left:  22.5%; }
    }
  </style>

</head> 

<body> 

	<div data-role="page" id="home"> 
		<div data-role="header">
			<h1>Form Validation Home</h1>
		</div>
		<div data-role="content">	
      <a href="#add-item" data-role="button">Add Item</a>
		</div>
	</div>

  <div data-role="page" id="add-item">
    <div data-role="header">
			<h1>Feedback Form</h1>
		</div>
		<div data-role="content">	
      <form action="/snackreview" method="POST">

        <div data-role="fieldcontain">
          <label for="age">Please enter your age:</label>
          <input type="text" name="age" id="age">
        </div>

        <div data-role="fieldcontain">
          <fieldset data-role="controlgroup">
            <legend>
              Please select your favourite snack:
            </legend>
            <input type="radio" name="snack" id="cheetos">
            <label for="cheetos">Cheetos</label>
            <input type="radio" name="snack" id="doritos">
            <label for="doritos">Doritos</label>
            <input type="radio" name="snack" id="fritos">
            <label for="fritos">Fritos</label>
            <input type="radio" name="snack" id="sunchips">
            <label for="sunchips">Sun Chips</label>
          </fieldset>
        </div>

        <div data-role="fieldcontain">
          <label for="feedback">Please describe why you love your favourite snack:</label>
          <textarea name="feedback" id="feedback"></textarea>
        </div>

        <div data-role="fieldcontain">
          <label for="email">Email address (optional):</label>
          <input type="text" name="email" id="email">
        </div>

        <div data-role="fieldcontain">
          <button type="submit" >Send</button>
          <a href="#home" data-role="button">Cancel</a>
        </div>
      </form>
		</div>
  </div>
</body>
</html>
